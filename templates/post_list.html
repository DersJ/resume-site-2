{%extends "base.html" %}

{% load django_bootstrap_breadcrumbs %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb "blog" "blog.views.post_list" %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="row my-1">
        <div class="col-lg-8 offset-lg-2">
            <!-- {% if user.is_authenticated %}
                <a href="/blog/create" class="btn btn-outline-secondary">Create new</a>
            {% endif %} -->
            <header class="mt-4">
                {% if sortBy == 'newest' %}
                        <h1>Newest Posts</h1>
                    {% elif sortBy == 'oldest' %}
                        <h1>Oldest Posts</h1>
                    {% elif sortBy == 'popular' %} 
                        <h1>Popular Posts</h1>
                    {% endif %}
                <div class="d-flex mt-4 justify-content-between align-items-baseline">
                    <div class="d-flex align-items-baseline filter-list">
                        <span>
                            Click to filter
                            {% for tag in allTags %}
                                <a data-slug="{{ tag.slug }}"
                                onclick="toggleTagHtmx(this.dataset.slug)"
                                class="badge rounded-pill filter-tag ms-1">
                                    {{ tag.title }}
                                </a>&#32;&#32;
                            {% endfor %}
                        </span>
                    </div>
                    <div class="d-flex flex-shrink-0 align-items-baseline" style="max-width: 300px">
                        <span class="flex-shrink-0 me-2">Sort</span>
                        {% load static %}
                        <select class="form-select" aria-label="sort select" id="sortSelect"
                        onchange="applySortHtmx(this.options[this.selectedIndex].value)"
                        style="background-image: url({% static 'styles/selectArrow.svg' %});">
                            <option value="newest">Newest</option>
                            <option value="oldest">Oldest</option>
                            <option value="popular">Most popular</option>
                        </select>
                    </div>
                </div>
            </header>

            <div id="post-list-container">
                {% include "post_list_content.html" %}
            </div>

            <div id="loading-indicator" class="htmx-indicator text-center my-3">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</div>

{% load static %}
<script defer src="{% static 'js/sortFilterHtmx.js' %}"></script>
<script defer>
    // Initialize state variables for htmx
    var appliedTags = {{ appliedTags|safe }};

    // Apply 'active' class to proper tags on initial load
    var filters = document.getElementsByClassName('filter-tag');
    for(var i = 0; i < filters.length; i++) {
        if (appliedTags.includes(filters[i].dataset.slug)) {
            filters[i].classList.add('active');
        }
    }
</script>
{% endblock content %}